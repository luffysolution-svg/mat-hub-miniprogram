<view class="container">
  <!-- Tabs -->
  <view class="tabs">
    <view
      class="tab-item {{activeTab === 'search' ? 'active' : ''}}"
      data-tab="search"
      bindtap="onTabChange"
    >
      <text>Searches</text>
      <text class="tab-count" wx:if="{{searchHistory.length > 0}}">{{searchHistory.length}}</text>
    </view>
    <view
      class="tab-item {{activeTab === 'viewed' ? 'active' : ''}}"
      data-tab="viewed"
      bindtap="onTabChange"
    >
      <text>Viewed</text>
      <text class="tab-count" wx:if="{{viewHistory.length > 0}}">{{viewHistory.length}}</text>
    </view>
  </view>

  <!-- Search History -->
  <view class="history-section" wx:if="{{activeTab === 'search'}}">
    <view class="section-header" wx:if="{{searchHistory.length > 0}}">
      <text class="section-title">Search History</text>
      <view class="header-actions">
        <text class="action-text" bindtap="toggleEdit">{{editing ? 'Done' : 'Edit'}}</text>
        <text class="action-text danger" bindtap="clearSearchHistory">Clear All</text>
      </view>
    </view>

    <view class="history-list" wx:if="{{searchHistory.length > 0}}">
      <view
        class="history-item"
        wx:for="{{searchHistory}}"
        wx:key="index"
        data-index="{{index}}"
        bindtap="onSearchHistoryTap"
      >
        <view class="item-icon">
          <text class="icon-text">üîç</text>
        </view>
        <view class="item-content">
          <text class="item-query">{{item.query}}</text>
          <view class="item-meta">
            <text class="meta-type">{{item.type || 'all'}}</text>
            <text class="meta-time">{{item.timeAgo}}</text>
          </view>
        </view>
        <view
          class="delete-btn"
          wx:if="{{editing}}"
          data-index="{{index}}"
          catchtap="deleteSearchItem"
        >
          <text class="delete-icon-text">üóë</text>
        </view>
        <view class="arrow-icon" wx:else>
          <text class="arrow-text">‚Ä∫</text>
        </view>
      </view>
    </view>

    <empty
      wx:if="{{searchHistory.length === 0}}"
      type="history"
      title="No Search History"
      description="Your recent searches will appear here"
    />
  </view>

  <!-- View History -->
  <view class="history-section" wx:if="{{activeTab === 'viewed'}}">
    <view class="section-header" wx:if="{{viewHistory.length > 0}}">
      <text class="section-title">Recently Viewed</text>
      <text class="action-text danger" bindtap="clearViewHistory">Clear All</text>
    </view>

    <view class="history-list" wx:if="{{viewHistory.length > 0}}">
      <view
        class="history-item"
        wx:for="{{viewHistory}}"
        wx:key="index"
        data-index="{{index}}"
        bindtap="onViewHistoryTap"
      >
        <view class="item-icon {{item.type}}">
          <text class="icon-text">{{item.type === 'material' ? '‚öóÔ∏è' : 'üìÑ'}}</text>
        </view>
        <view class="item-content">
          <text class="item-title">{{item.title}}</text>
          <view class="item-meta">
            <text class="meta-source">{{item.sourceName}}</text>
            <text class="meta-time">{{item.timeAgo}}</text>
          </view>
        </view>
        <view class="arrow-icon">
          <text class="arrow-text">‚Ä∫</text>
        </view>
      </view>
    </view>

    <empty
      wx:if="{{viewHistory.length === 0}}"
      type="history"
      title="No Viewed Items"
      description="Items you view will appear here"
    />
  </view>
</view>
