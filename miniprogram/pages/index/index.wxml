<scroll-view
  class="container"
  scroll-y
  scroll-top="{{scrollTop}}"
  scroll-with-animation
  bindscroll="onPageScroll"
  bindscrolltolower="onReachBottom"
  lower-threshold="100"
  enhanced="{{true}}"
  show-scrollbar="{{false}}"
>
  <!-- Search Bar -->
  <search-bar
    value="{{query}}"
    bind:input="onInput"
    bind:search="onSearch"
    bind:clear="onClear"
    bind:filter="onFilterTap"
  />

  <!-- Quick Type Toggle -->
  <view class="type-toggle">
    <view
      class="type-item {{queryType === 'all' ? 'active' : ''}}"
      data-type="all"
      bindtap="onTypeChange"
    >All</view>
    <view
      class="type-item {{queryType === 'material' ? 'active' : ''}}"
      data-type="material"
      bindtap="onTypeChange"
    >Materials</view>
    <view
      class="type-item {{queryType === 'literature' ? 'active' : ''}}"
      data-type="literature"
      bindtap="onTypeChange"
    >Literature</view>
  </view>

  <!-- Results Section -->
  <view class="results-section" wx:if="{{searched}}">
    <!-- Results Header -->
    <view class="results-header" wx:if="{{!loading && results.length > 0}}">
      <text class="results-count">{{total}} results</text>
      <text class="results-sort" wx:if="{{failedSources.length > 0}}">
        {{failedSources.length}} sources failed
      </text>
    </view>

    <!-- Loading State -->
    <skeleton type="card" count="{{3}}" wx:if="{{loading}}" />

    <!-- Results List -->
    <view class="results-list" wx:if="{{!loading && results.length > 0}}">
      <result-card
        wx:for="{{results}}"
        wx:key="id"
        item="{{item}}"
        bind:tap="onResultTap"
        bind:favorite="onFavoriteChange"
      />

      <!-- Load More -->
      <view class="load-more" wx:if="{{hasMore}}">
        <view class="loading-spinner" wx:if="{{loadingMore}}"></view>
        <text class="load-more-text" wx:else>Pull up to load more</text>
      </view>

      <!-- No More -->
      <view class="no-more" wx:if="{{!hasMore && results.length > 0}}">
        <text>No more results</text>
      </view>
    </view>

    <!-- Empty State -->
    <empty
      wx:if="{{!loading && results.length === 0}}"
      type="search"
    />
  </view>

  <!-- Initial State -->
  <view class="initial-state" wx:if="{{!searched}}">
    <text class="initial-icon-text">ðŸ”¬</text>
    <text class="initial-title">Search Materials & Literature</text>
    <text class="initial-desc">
      Access 9 data sources including Materials Project, PubChem, arXiv, and more
    </text>

    <!-- Search Help Card -->
    <view class="search-help-card">
      <view class="help-card-header">
        <text class="help-card-icon">ðŸ’¡</text>
        <text class="help-card-title">Search Tips</text>
      </view>

      <view class="syntax-tags">
        <view class="syntax-tag">
          <text class="tag-code">"..."</text>
          <text class="tag-label">Exact</text>
        </view>
        <view class="syntax-tag">
          <text class="tag-code">-word</text>
          <text class="tag-label">Exclude</text>
        </view>
        <view class="syntax-tag">
          <text class="tag-code">OR</text>
          <text class="tag-label">Either</text>
        </view>
        <view class="syntax-tag">
          <text class="tag-code">DOI</text>
          <text class="tag-label">Direct</text>
        </view>
      </view>

      <view class="help-divider"></view>

      <text class="examples-label">Quick Search</text>
      <view class="example-chips">
        <text class="example-chip" bindtap="onExampleTap" data-query='"machine learning" catalyst'>
          "machine learning" catalyst
        </text>
        <text class="example-chip" bindtap="onExampleTap" data-query="perovskite -review">
          perovskite -review
        </text>
        <text class="example-chip" bindtap="onExampleTap" data-query="TiO2 OR ZnO">
          TiO2 OR ZnO
        </text>
      </view>
    </view>
  </view>

  <!-- Filter Panel -->
  <filter-panel
    visible="{{showFilters}}"
    queryType="{{queryType}}"
    selectedSources="{{selectedSources}}"
    sortBy="{{sortBy}}"
    filters="{{filters}}"
    bind:close="onFilterClose"
    bind:typechange="onTypeChange"
    bind:sortchange="onSortChange"
    bind:sourcechange="onSourceChange"
    bind:filterchange="onFilterChange"
    bind:reset="onFilterReset"
    bind:apply="onFilterApply"
  />
</scroll-view>

<!-- Back to Top Button -->
<view class="back-to-top {{showBackTop ? 'show' : ''}}" bindtap="scrollToTop">
  <text class="back-top-icon">â†‘</text>
</view>
