<view class="container">
  <!-- Tabåˆ‡æ¢ -->
  <view class="tab-bar">
    <view
      class="tab-item {{activeTab === 'molar_mass' ? 'active' : ''}}"
      data-tab="molar_mass"
      bindtap="switchTab"
    >
      <text class="tab-icon">âš—ï¸</text>
      <text class="tab-label">åˆ†å­è´¨é‡</text>
    </view>
    <view
      class="tab-item {{activeTab === 'solution' ? 'active' : ''}}"
      data-tab="solution"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ§ª</text>
      <text class="tab-label">æº¶æ¶²é…åˆ¶</text>
    </view>
    <view
      class="tab-item {{activeTab === 'concentration' ? 'active' : ''}}"
      data-tab="concentration"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ“Š</text>
      <text class="tab-label">æµ“åº¦è½¬æ¢</text>
    </view>
    <view
      class="tab-item {{activeTab === 'unit' ? 'active' : ''}}"
      data-tab="unit"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ“</text>
      <text class="tab-label">å•ä½è½¬æ¢</text>
    </view>
  </view>

  <!-- åˆ†å­è´¨é‡è®¡ç®— -->
  <scroll-view class="content" scroll-y wx:if="{{activeTab === 'molar_mass'}}">
    <view class="calc-section">
      <view class="section-title">è¾“å…¥åŒ–å­¦å¼</view>
      <view class="input-group">
        <input
          class="formula-input"
          type="text"
          placeholder="ä¾‹å¦‚: H2SO4"
          value="{{formula}}"
          bindinput="onFormulaInput"
        />
        <button class="calc-btn" bindtap="calculateMolarMass">è®¡ç®—</button>
      </view>

      <!-- å¿«æ·å…¬å¼ -->
      <view class="quick-formulas">
        <text class="quick-label">å¸¸ç”¨åŒ–å­¦å¼:</text>
        <view class="formula-tags">
          <view
            class="formula-tag"
            wx:for="{{quickFormulas}}"
            wx:key="formula"
            data-formula="{{item.formula}}"
            bindtap="quickFill"
          >
            {{item.formula}}
          </view>
        </view>
      </view>

      <!-- è®¡ç®—ç»“æœ -->
      <view class="result-box" wx:if="{{molarResult}}">
        <view class="result-header">
          <text class="result-formula">{{molarResult.formula}}</text>
          <text class="result-mass">{{molarResult.molarMass}} g/mol</text>
        </view>
        <view class="result-breakdown">
          <view class="breakdown-title">ç»„æˆåˆ†æ:</view>
          <view
            class="breakdown-item"
            wx:for="{{molarResult.breakdown}}"
            wx:key="element"
          >
            <text class="element">{{item.element}}</text>
            <text class="count">Ã— {{item.count}}</text>
            <text class="mass">{{item.mass}} g/mol</text>
          </view>
        </view>
      </view>

      <!-- å†å²è®°å½• -->
      <view class="history-section" wx:if="{{calcHistory.length > 0}}">
        <view class="section-title">æœ€è¿‘è®¡ç®—</view>
        <view
          class="history-item"
          wx:for="{{calcHistory}}"
          wx:key="timestamp"
          data-formula="{{item.formula}}"
          bindtap="quickFill"
        >
          <text class="history-formula">{{item.formula}}</text>
          <text class="history-mass">{{item.molarMass}} g/mol</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- æº¶æ¶²é…åˆ¶è®¡ç®— -->
  <scroll-view class="content" scroll-y wx:if="{{activeTab === 'solution'}}">
    <view class="calc-section">
      <view class="section-title">è¾“å…¥å‚æ•°ï¼ˆç•™ç©ºä¸€ä¸ªå¾…è®¡ç®—ï¼‰</view>

      <view class="param-group">
        <text class="param-label">æº¶è´¨è´¨é‡ (g)</text>
        <input
          class="param-input"
          type="digit"
          placeholder="è´¨é‡"
          value="{{solutionParams.mass}}"
          data-field="mass"
          bindinput="onSolutionInput"
        />
      </view>

      <view class="param-group">
        <text class="param-label">æº¶æ¶²ä½“ç§¯ (L)</text>
        <input
          class="param-input"
          type="digit"
          placeholder="ä½“ç§¯"
          value="{{solutionParams.volume}}"
          data-field="volume"
          bindinput="onSolutionInput"
        />
      </view>

      <view class="param-group">
        <text class="param-label">æ‘©å°”è´¨é‡ (g/mol)</text>
        <input
          class="param-input"
          type="digit"
          placeholder="æ‘©å°”è´¨é‡"
          value="{{solutionParams.molarMass}}"
          data-field="molarMass"
          bindinput="onSolutionInput"
        />
      </view>

      <view class="param-group">
        <text class="param-label">æµ“åº¦ (mol/L)</text>
        <input
          class="param-input"
          type="digit"
          placeholder="æµ“åº¦"
          value="{{solutionParams.concentration}}"
          data-field="concentration"
          bindinput="onSolutionInput"
        />
      </view>

      <view class="btn-group">
        <button class="calc-btn primary" bindtap="calculateSolution">è®¡ç®—</button>
        <button class="calc-btn" bindtap="clearForm">æ¸…ç©º</button>
      </view>

      <!-- è®¡ç®—ç»“æœ -->
      <view class="result-box" wx:if="{{solutionResult}}">
        <view class="result-type">{{solutionResult.type}}</view>
        <view class="result-value">
          {{solutionResult.mass || solutionResult.volume || solutionResult.concentration}}
        </view>
        <view class="result-desc">{{solutionResult.description}}</view>
      </view>
    </view>
  </scroll-view>

  <!-- æµ“åº¦è½¬æ¢ -->
  <scroll-view class="content" scroll-y wx:if="{{activeTab === 'concentration'}}">
    <view class="calc-section">
      <view class="section-title">æµ“åº¦å•ä½è½¬æ¢</view>

      <view class="param-group">
        <text class="param-label">æµ“åº¦å€¼</text>
        <input
          class="param-input"
          type="digit"
          placeholder="è¾“å…¥æ•°å€¼"
          value="{{concentrationParams.value}}"
          data-field="value"
          bindinput="onConcentrationInput"
        />
      </view>

      <view class="param-group">
        <text class="param-label">ä»</text>
        <picker
          class="param-picker"
          mode="selector"
          range="{{concentrationUnits}}"
          range-key="label"
          value="{{concentrationParams.fromUnit}}"
          bindchange="onFromUnitChange"
        >
          <view class="picker-view">
            {{concentrationParams.fromUnit}}
          </view>
        </picker>
      </view>

      <view class="param-group">
        <text class="param-label">åˆ°</text>
        <picker
          class="param-picker"
          mode="selector"
          range="{{concentrationUnits}}"
          range-key="label"
          value="{{concentrationParams.toUnit}}"
          bindchange="onToUnitChange"
        >
          <view class="picker-view">
            {{concentrationParams.toUnit}}
          </view>
        </picker>
      </view>

      <view class="param-group">
        <text class="param-label">æ‘©å°”è´¨é‡ (g/mol)</text>
        <input
          class="param-input"
          type="digit"
          placeholder="æº¶è´¨çš„æ‘©å°”è´¨é‡"
          value="{{concentrationParams.molarMass}}"
          data-field="molarMass"
          bindinput="onConcentrationInput"
        />
      </view>

      <view class="btn-group">
        <button class="calc-btn primary" bindtap="convertConcentration">è½¬æ¢</button>
        <button class="calc-btn" bindtap="clearForm">æ¸…ç©º</button>
      </view>

      <!-- è½¬æ¢ç»“æœ -->
      <view class="result-box" wx:if="{{concentrationResult}}">
        <view class="result-header">
          <text class="result-label">è½¬æ¢ç»“æœ:</text>
          <text class="result-value">{{concentrationResult.value}} {{concentrationResult.unit}}</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- å•ä½è½¬æ¢ -->
  <scroll-view class="content" scroll-y wx:if="{{activeTab === 'unit'}}">
    <view class="calc-section">
      <view class="section-title">ç‰©ç†å•ä½è½¬æ¢</view>

      <view class="param-group">
        <text class="param-label">è½¬æ¢ç±»åˆ«</text>
        <picker
          class="param-picker"
          mode="selector"
          range="{{unitCategories}}"
          range-key="name"
          bindchange="onUnitCategoryChange"
        >
          <view class="picker-view">
            {{unitCategories[0].name}}
          </view>
        </picker>
      </view>

      <view class="param-group">
        <text class="param-label">æ•°å€¼</text>
        <input
          class="param-input"
          type="digit"
          placeholder="è¾“å…¥æ•°å€¼"
          value="{{unitParams.value}}"
          data-field="value"
          bindinput="onUnitInput"
        />
      </view>

      <view class="param-group">
        <text class="param-label">ä»å•ä½</text>
        <input
          class="param-input"
          type="text"
          placeholder="å¦‚: g"
          value="{{unitParams.fromUnit}}"
          data-field="fromUnit"
          bindinput="onUnitInput"
        />
      </view>

      <view class="param-group">
        <text class="param-label">åˆ°å•ä½</text>
        <input
          class="param-input"
          type="text"
          placeholder="å¦‚: kg"
          value="{{unitParams.toUnit}}"
          data-field="toUnit"
          bindinput="onUnitInput"
        />
      </view>

      <view class="btn-group">
        <button class="calc-btn primary" bindtap="convertUnit">è½¬æ¢</button>
        <button class="calc-btn" bindtap="clearForm">æ¸…ç©º</button>
      </view>

      <!-- è½¬æ¢ç»“æœ -->
      <view class="result-box" wx:if="{{unitResult}}">
        <view class="result-header">
          <text class="result-label">è½¬æ¢ç»“æœ:</text>
          <text class="result-value">{{unitResult.value}} {{unitResult.unit}}</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
